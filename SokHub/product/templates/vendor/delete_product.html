<!-- templates/products/vendor/delete_product.html -->
{% extends "base.html" %}

{% block title %}Delete {{ product.name }} - SokHub{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Warning Card -->
            <div class="card border-danger shadow-sm">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i> Delete Product
                    </h5>
                </div>
                <div class="card-body text-center">
                    <!-- Product Info -->
                    <div class="mb-4">
                        {% if product.main_image %}
                            <img src="{{ product.main_image.url }}" 
                                 alt="{{ product.name }}" 
                                 class="img-fluid rounded mb-3" 
                                 style="max-height: 200px; object-fit: cover;">
                        {% else %}
                            <div class="bg-light rounded d-flex align-items-center justify-content-center mx-auto mb-3" 
                                 style="height: 200px; width: 200px;">
                                <i class="fas fa-image fa-3x text-muted"></i>
                            </div>
                        {% endif %}
                        
                        <h4 class="mb-2">{{ product.name }}</h4>
                        <p class="text-muted mb-0">SKU: {{ product.sku|default:"N/A" }}</p>
                        <p class="text-muted mb-0">Price: {{ product.price }} RWF</p>
                        <p class="text-muted mb-0">Stock: {{ product.get_available_quantity }}</p>
                        {% if product.category %}
                            <p class="text-muted mb-0">Category: {{ product.category.name }}</p>
                        {% endif %}
                    </div>

                    <!-- Warning Message -->
                    <div class="alert alert-warning" role="alert">
                        <h4 class="alert-heading">
                            <i class="fas fa-exclamation-circle me-2"></i> Warning!
                        </h4>
                        <p class="mb-0">
                            You are about to delete <strong>"{{ product.name }}"</strong>. 
                            This action cannot be undone. All product data including images will be permanently removed.
                        </p>
                        {% if product.get_available_quantity > 0 %}
                            <hr>
                            <p class="mb-0">
                                <i class="fas fa-box me-2"></i>
                                This product has <strong>{{ product.get_available_quantity }}</strong> items in stock. 
                                Deleting it will remove these from inventory.
                            </p>
                        {% endif %}
                    </div>

                    <!-- Delete Form -->
                    <form method="POST">
                        {% csrf_token %}
                        <div class="d-flex justify-content-center gap-3 mt-4">
                            <button type="submit" class="btn btn-danger btn-lg px-4">
                                <i class="fas fa-trash-alt me-2"></i> Confirm Delete
                            </button>
                            <a href="{% url redirect_target %}" class="btn btn-outline-secondary btn-lg px-4">
                                <i class="fas fa-times me-2"></i> Cancel
                            </a>
                        </div>
                        
                        <!-- Optional: Confirmation checkbox for extra safety -->
                        <div class="form-check mt-4 d-flex justify-content-center">
                            <input class="form-check-input" type="checkbox" id="confirmDelete" required>
                            <label class="form-check-label ms-2" for="confirmDelete">
                                I understand this action is permanent and cannot be undone
                            </label>
                        </div>
                    </form>
                </div>
                <div class="card-footer text-muted text-center">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        Deleting this product will also remove it from any customer orders and recommendations.
                    </small>
                </div>
            </div>
            
            <!-- Additional Info Card -->
            <div class="card mt-4 border-warning">
                <div class="card-header bg-warning">
                    <h6 class="mb-0">
                        <i class="fas fa-history me-2"></i> Recently Added Products
                    </h6>
                </div>
                <div class="card-body">
                    <p class="mb-0">
                        Consider if you want to <strong>deactivate</strong> instead of delete. 
                        Deactivated products won't be visible to customers but can be restored later.
                    </p>
                    <div class="mt-3">
                        {% if is_owner %}
                        <form method="post" action="{% url 'vendor_toggle_product_status' product.pk %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-warning btn-sm">
                                <i class="fas fa-eye-slash me-1"></i>
                                {% if product.status == 'active' %}Move to Draft{% else %}Activate{% endif %}
                            </button>
                        </form>
                        {% else %}
                        <div class="alert alert-info mb-0">
                            <i class="fas fa-user-shield me-1"></i>
                            As an admin, you can delete products directly. Vendors can deactivate instead.
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// JavaScript for confirmation
document.querySelector('form').addEventListener('submit', function(e) {
    const confirmCheckbox = document.getElementById('confirmDelete');
    if (!confirmCheckbox.checked) {
        e.preventDefault();
        alert('Please check the confirmation box to delete the product.');
        return false;
    }
    
    // Optional: Double confirmation
    if (!confirm('Are you absolutely sure you want to delete this product? This cannot be undone!')) {
        e.preventDefault();
        return false;
    }
});
</script>

<style>
/* Additional styling */
.card {
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}

.btn-danger {
    transition: all 0.2s;
}

.btn-danger:hover {
    background-color: #bb2d3b;
    border-color: #bb2d3b;
    transform: scale(1.05);
}

.product-image-preview {
    border: 2px solid #dee2e6;
    border-radius: 8px;
    overflow: hidden;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .btn-lg {
        padding: 0.5rem 1rem;
        font-size: 1rem;
    }
    
    .card-body {
        padding: 1rem;
    }
}
</style>
{% endblock %}